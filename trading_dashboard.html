<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yahoo Finance Trading Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.8em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header .logo {
            color: #f39c12;
            font-size: 1.2em;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            border-left: 5px solid;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card.win-rate { border-left-color: #27ae60; }
        .stat-card.total-trades { border-left-color: #3498db; }
        .stat-card.profit { border-left-color: #f39c12; }
        .stat-card.streak { border-left-color: #e74c3c; }
        .stat-card.pairs { border-left-color: #9b59b6; }
        .stat-card.cost { border-left-color: #1abc9c; }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .win-rate { color: #27ae60; }
        .total-trades { color: #3498db; }
        .profit { color: #f39c12; }
        .streak { color: #e74c3c; }
        .pairs { color: #9b59b6; }
        .cost { color: #1abc9c; }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            color: white;
        }

        .section-title {
            font-size: 1.8em;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .refresh-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .refresh-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .chart-title {
            font-size: 1.3em;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .pairs-overview {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .pairs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .pair-category {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border-left: 5px solid;
        }

        .pair-category.forex { border-left-color: #3498db; }
        .pair-category.commodities { border-left-color: #f39c12; }
        .pair-category.crypto { border-left-color: #e74c3c; }

        .category-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pairs-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }

        .pair-item {
            background: white;
            padding: 8px 12px;
            border-radius: 8px;
            text-align: center;
            font-size: 0.9em;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }

        .pair-item:hover {
            transform: translateY(-2px);
        }

        .signals-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .tabs-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab-button:hover {
            background: #e9ecef;
            color: #495057;
        }

        .tab-button.active {
            background: white;
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
        }

        .tab-content {
            display: none;
            padding: 25px;
        }

        .tab-content.active {
            display: block;
        }

        .signal-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #3498db;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            transition: transform 0.2s ease;
        }

        .signal-item:hover {
            transform: translateY(-2px);
        }

        .signal-info {
            flex: 1;
            min-width: 300px;
        }

        .signal-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .signal-symbol {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
        }

        .signal-type {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .signal-type.demand {
            background: #d5f4e6;
            color: #27ae60;
        }

        .signal-type.supply {
            background: #fadbd8;
            color: #e74c3c;
        }

        .signal-details {
            color: #7f8c8d;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .signal-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-win {
            background: #27ae60;
            color: white;
        }

        .btn-win:hover {
            background: #229954;
        }

        .btn-loss {
            background: #e74c3c;
            color: white;
        }

        .btn-loss:hover {
            background: #c0392b;
        }

        .status-completed {
            background: #e8f5e8;
            border-left-color: #27ae60;
        }

        .status-win {
            background: #e8f5e8;
            border-left-color: #27ae60;
        }

        .status-loss {
            background: #fdf2f2;
            border-left-color: #e74c3c;
        }

        .outcome-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .outcome-win {
            background: #27ae60;
            color: white;
        }

        .outcome-loss {
            background: #e74c3c;
            color: white;
        }

        .outcome-active {
            background: #3498db;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .no-signals {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .refresh-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 0.9em;
            display: none;
            z-index: 1000;
        }

        .api-status {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #27ae60;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 0.9em;
            z-index: 1000;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }

            .header h1 {
                font-size: 2em;
                flex-direction: column;
                gap: 10px;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .pairs-grid {
                grid-template-columns: 1fr;
            }

            .signal-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .signal-actions {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="refresh-indicator" id="refreshIndicator">
        <i class="fas fa-sync-alt"></i> Data Updated ✓
    </div>

    <div class="api-status">
        <i class="fas fa-wifi"></i> Yahoo Finance (FREE)
    </div>

    <div class="container">
        <div class="header">
            <h1>
                <i class="fas fa-chart-line logo"></i>
                Yahoo Finance Trading Dashboard
                <i class="fas fa-gem logo"></i>
            </h1>
            <p>Real-time tracking across 19 markets • Zero cost • Unlimited data</p>
        </div>

        <div class="stats-bar">
            <div class="stat-card win-rate">
                <div class="stat-value win-rate" id="winRate">--</div>
                <div class="stat-label">Win Rate</div>
            </div>
            <div class="stat-card total-trades">
                <div class="stat-value total-trades" id="totalTrades">--</div>
                <div class="stat-label">Total Trades</div>
            </div>
            <div class="stat-card profit">
                <div class="stat-value profit" id="netProfit">--</div>
                <div class="stat-label">Net P&L</div>
            </div>
            <div class="stat-card streak">
                <div class="stat-value streak" id="currentStreak">--</div>
                <div class="stat-label">Current Streak</div>
            </div>
            <div class="stat-card pairs">
                <div class="stat-value pairs" id="totalPairs">19</div>
                <div class="stat-label">Trading Pairs</div>
            </div>
            <div class="stat-card cost">
                <div class="stat-value cost" id="monthlyCost">$0</div>
                <div class="stat-label">Monthly Cost</div>
            </div>
        </div>

        <div class="section-header">
            <div class="section-title">
                <i class="fas fa-coins"></i>
                Trading Pairs Overview
            </div>
            <button class="refresh-btn" onclick="refreshData()">
                <i class="fas fa-sync-alt"></i>
                Refresh Data
            </button>
        </div>

        <div class="pairs-overview">
            <div class="pairs-grid">
                <div class="pair-category forex">
                    <div class="category-title">
                        <i class="fas fa-globe"></i>
                        Major Forex Pairs (8)
                    </div>
                    <div class="pairs-list">
                        <div class="pair-item">EUR/USD</div>
                        <div class="pair-item">GBP/USD</div>
                        <div class="pair-item">USD/JPY</div>
                        <div class="pair-item">AUD/USD</div>
                        <div class="pair-item">USD/CHF</div>
                        <div class="pair-item">NZD/USD</div>
                        <div class="pair-item">USD/CAD</div>
                        <div class="pair-item">EUR/GBP</div>
                    </div>
                </div>

                <div class="pair-category forex">
                    <div class="category-title">
                        <i class="fas fa-exchange-alt"></i>
                        Cross Pairs (6)
                    </div>
                    <div class="pairs-list">
                        <div class="pair-item">EUR/JPY</div>
                        <div class="pair-item">GBP/JPY</div>
                        <div class="pair-item">AUD/JPY</div>
                        <div class="pair-item">EUR/CHF</div>
                        <div class="pair-item">GBP/CHF</div>
                        <div class="pair-item">AUD/CAD</div>
                    </div>
                </div>

                <div class="pair-category commodities">
                    <div class="category-title">
                        <i class="fas fa-gem"></i>
                        Commodities (3)
                    </div>
                    <div class="pairs-list">
                        <div class="pair-item">GOLD</div>
                        <div class="pair-item">SILVER</div>
                        <div class="pair-item">OIL</div>
                    </div>
                </div>

                <div class="pair-category crypto">
                    <div class="category-title">
                        <i class="fab fa-bitcoin"></i>
                        Crypto (2)
                    </div>
                    <div class="pairs-list">
                        <div class="pair-item">BITCOIN</div>
                        <div class="pair-item">ETHEREUM</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section-header">
            <div class="section-title">
                <i class="fas fa-chart-bar"></i>
                Performance Analytics
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-container">
                <div class="chart-title">
                    <i class="fas fa-chart-line"></i>
                    Win Rate Trend
                </div>
                <canvas id="winRateChart" width="400" height="200"></canvas>
            </div>

            <div class="chart-container">
                <div class="chart-title">
                    <i class="fas fa-chart-pie"></i>
                    Performance by Category
                </div>
                <canvas id="categoryChart" width="400" height="200"></canvas>
            </div>
        </div>

        <div class="section-header">
            <div class="section-title">
                <i class="fas fa-chart-line"></i>
                Trade Management
            </div>
        </div>

        <div class="tabs-container">
            <div class="tabs">
                <button class="tab-button active" onclick="showTab('completed')">
                    <i class="fas fa-check-circle"></i>
                    Completed Trades
                </button>
                <button class="tab-button" onclick="showTab('active')">
                    <i class="fas fa-clock"></i>
                    Active Trades
                </button>
            </div>
            
            <div id="completedTab" class="tab-content active">
                <div id="completedContainer" class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    Loading completed trades...
                </div>
            </div>
            
            <div id="activeTab" class="tab-content">
                <div id="activeContainer" class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    Loading active trades...
                </div>
            </div>
        </div>
    </div>

    <script>
        let signalsData = [];
        let tradeStats = {};
        let winRateChart = null;
        let categoryChart = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setInterval(loadData, 60000); // Auto-refresh every minute
        });

        // Tab switching functions
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
            
            // Update the content
            updateTradesDisplay();
        }

        function loadData() {
            // Load trade data with $10 risk tracking
            Promise.all([
                fetch('/api/trades').then(r => r.json()).catch(() => []),
                fetch('/api/trade_stats').then(r => r.json()).catch(() => ({}))
            ]).then(([trades, stats]) => {
                signalsData = trades;
                tradeStats = stats;
                updateMetrics();
                updateCharts();
                updateTradesDisplay();
                showRefreshIndicator();
            }).catch(error => {
                console.log('Loading data...', error);
                signalsData = [];
                updateMetrics();
                updateCharts();
                updateTradesDisplay();
                showRefreshIndicator();
            });
        }

        function updateMetrics() {
            // Use trade stats if available, otherwise calculate from signals
            if (tradeStats && tradeStats.total_trades > 0) {
                const winRate = tradeStats.win_rate || 0;
                const completedTrades = tradeStats.completed_trades || 0;
                const netPnL = tradeStats.total_pnl || 0;
                
                // Calculate streak from signals data
                const completed = signalsData.filter(s => s.status === 'win' || s.status === 'loss');
                let streak = 0;
                let streakType = '';
                for (let i = completed.length - 1; i >= 0; i--) {
                    const trade = completed[i];
                    if (i === completed.length - 1) {
                        streakType = trade.status;
                        streak = 1;
                    } else if (trade.status === streakType) {
                        streak++;
                    } else {
                        break;
                    }
                }
                
                document.getElementById('winRate').textContent = winRate.toFixed(1) + '%';
                document.getElementById('totalTrades').textContent = completedTrades;
                document.getElementById('netProfit').textContent = netPnL >= 0 ? '+$' + netPnL.toFixed(0) : '-$' + Math.abs(netPnL).toFixed(0);
                document.getElementById('currentStreak').textContent = streak > 0 ? (streakType === 'win' ? 'W' : 'L') + streak : '--';
            } else {
                // Fallback to old calculation
                const completedTrades = signalsData.filter(s => s.outcome);
                const wins = completedTrades.filter(s => s.outcome === 'win').length;
                const winRate = completedTrades.length > 0 ? (wins / completedTrades.length * 100) : 0;
                const netPnL = completedTrades.reduce((sum, trade) => sum + (trade.pnl || 0), 0);
                
                document.getElementById('winRate').textContent = winRate.toFixed(1) + '%';
                document.getElementById('totalTrades').textContent = completedTrades.length;
                document.getElementById('netProfit').textContent = netPnL >= 0 ? '+$' + netPnL.toFixed(0) : '-$' + Math.abs(netPnL).toFixed(0);
                document.getElementById('currentStreak').textContent = '--';
            }
        }

        function updateCharts() {
            updateWinRateChart();
            updateCategoryChart();
        }

        function updateWinRateChart() {
            const ctx = document.getElementById('winRateChart').getContext('2d');

            if (winRateChart) {
                winRateChart.destroy();
            }

            // Generate sample win rate trend data
            const dates = [];
            const winRates = [];
            const today = new Date();

            for (let i = 14; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                dates.push(date.toLocaleDateString());

                // Simulate improving win rate from 0% to current
                const progress = (14 - i) / 14;
                const baseRate = signalsData.filter(s => s.outcome).length > 0 ? 60 : 0;
                const rate = baseRate + (progress * 20) + (Math.random() * 10 - 5);
                winRates.push(Math.max(0, Math.min(100, rate)));
            }

            winRateChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Win Rate %',
                        data: winRates,
                        borderColor: '#27ae60',
                        backgroundColor: 'rgba(39, 174, 96, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateCategoryChart() {
            const ctx = document.getElementById('categoryChart').getContext('2d');

            if (categoryChart) {
                categoryChart.destroy();
            }

            // Calculate performance by category
            const categories = {
                'Forex': 0,
                'Commodities': 0,
                'Crypto': 0
            };

            signalsData.forEach(signal => {
                if (signal.outcome) {
                    const category = getCategoryForSymbol(signal.symbol);
                    categories[category]++;
                }
            });

            const categoryLabels = Object.keys(categories);
            const categoryValues = Object.values(categories);

            categoryChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categoryLabels,
                    datasets: [{
                        data: categoryValues,
                        backgroundColor: [
                            '#3498db',
                            '#f39c12',
                            '#e74c3c'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function getCategoryForSymbol(symbol) {
            const forexPairs = ['EUR/USD', 'GBP/USD', 'USD/JPY', 'AUD/USD', 'USD/CHF', 'NZD/USD', 'USD/CAD', 'EUR/GBP', 'EUR/JPY', 'GBP/JPY', 'AUD/JPY', 'EUR/CHF', 'GBP/CHF', 'AUD/CAD'];
            const commodities = ['GOLD', 'SILVER', 'OIL'];
            const crypto = ['BITCOIN', 'ETHEREUM'];

            if (forexPairs.includes(symbol)) return 'Forex';
            if (commodities.includes(symbol)) return 'Commodities';
            if (crypto.includes(symbol)) return 'Crypto';
            return 'Forex'; // default
        }

        function updateTradesDisplay() {
            updateCompletedTrades();
            updateActiveTrades();
        }

        function updateCompletedTrades() {
            const container = document.getElementById('completedContainer');
            const completedTrades = signalsData.filter(trade => trade.status === 'win' || trade.status === 'loss');

            if (completedTrades.length === 0) {
                container.innerHTML = `
                    <div class="no-signals">
                        <i class="fas fa-check-circle" style="font-size: 3em; color: #bdc3c7; margin-bottom: 20px;"></i>
                        <h3>No completed trades yet</h3>
                        <p>Completed trades will appear here once they hit stop or target</p>
                    </div>
                `;
                return;
            }

            const sortedTrades = completedTrades.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            container.innerHTML = sortedTrades.map(trade => {
                const date = new Date(trade.timestamp).toLocaleDateString();
                const time = new Date(trade.timestamp).toLocaleTimeString();
                const statusClass = `status-${trade.status}`;
                const direction = trade.direction || (trade.zone_type === 'supply' ? 'SHORT' : 'LONG');
                const risk = trade.risk_amount || 10;
                const potential = trade.potential_profit || (risk * trade.risk_reward);

                return `
                    <div class="signal-item ${statusClass}">
                        <div class="signal-info">
                            <div class="signal-header">
                                <div class="signal-symbol">
                                    ${trade.symbol}
                                </div>
                                <div class="signal-type ${trade.zone_type}">
                                    ${trade.zone_type} - ${direction}
                                </div>
                                <div class="outcome-badge outcome-${trade.status}">${trade.status.toUpperCase()}</div>
                            </div>
                            <div class="signal-details">
                                <strong>Entry:</strong> ${trade.entry.toFixed(5)} | 
                                <strong>Stop:</strong> ${trade.stop.toFixed(5)} | 
                                <strong>Target:</strong> ${trade.target.toFixed(5)} | 
                                <strong>R:R:</strong> ${trade.risk_reward.toFixed(1)}:1<br>
                                <strong>Risk:</strong> $${risk.toFixed(0)} | 
                                <strong>Potential:</strong> $${potential.toFixed(0)}<br>
                                <strong>Time:</strong> ${date} ${time}
                                ${trade.pnl ? ` | <strong>P&L:</strong> ${trade.pnl > 0 ? '+' : ''}$${trade.pnl.toFixed(0)}` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateActiveTrades() {
            const container = document.getElementById('activeContainer');
            const activeTrades = signalsData.filter(trade => trade.status === 'active');

            if (activeTrades.length === 0) {
                container.innerHTML = `
                    <div class="no-signals">
                        <i class="fas fa-clock" style="font-size: 3em; color: #bdc3c7; margin-bottom: 20px;"></i>
                        <h3>No active trades</h3>
                        <p>Active trades will appear here when new signals are generated</p>
                    </div>
                `;
                return;
            }

            const sortedTrades = activeTrades.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            container.innerHTML = sortedTrades.map(trade => {
                const date = new Date(trade.timestamp).toLocaleDateString();
                const time = new Date(trade.timestamp).toLocaleTimeString();
                const direction = trade.direction || (trade.zone_type === 'supply' ? 'SHORT' : 'LONG');
                const risk = trade.risk_amount || 10;
                const potential = trade.potential_profit || (risk * trade.risk_reward);

                return `
                    <div class="signal-item">
                        <div class="signal-info">
                            <div class="signal-header">
                                <div class="signal-symbol">
                                    ${trade.symbol}
                                </div>
                                <div class="signal-type ${trade.zone_type}">
                                    ${trade.zone_type} - ${direction}
                                </div>
                                <div class="outcome-badge outcome-active">ACTIVE</div>
                            </div>
                            <div class="signal-details">
                                <strong>Entry:</strong> ${trade.entry.toFixed(5)} | 
                                <strong>Stop:</strong> ${trade.stop.toFixed(5)} | 
                                <strong>Target:</strong> ${trade.target.toFixed(5)} | 
                                <strong>R:R:</strong> ${trade.risk_reward.toFixed(1)}:1<br>
                                <strong>Risk:</strong> $${risk.toFixed(0)} | 
                                <strong>Potential:</strong> $${potential.toFixed(0)}<br>
                                <strong>Time:</strong> ${date} ${time}
                            </div>
                        </div>
                        <div class="signal-actions">
                            <button class="btn btn-win" onclick="recordOutcome('${trade.trade_id || trade.signal_id}', 'win')">
                                <i class="fas fa-check"></i> Win
                            </button>
                            <button class="btn btn-loss" onclick="recordOutcome('${trade.trade_id || trade.signal_id}', 'loss')">
                                <i class="fas fa-times"></i> Loss
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function recordOutcome(signalId, outcome) {
            const signal = signalsData.find(s => s.signal_id === signalId);
            if (signal) {
                signal.outcome = outcome;
                signal.status = 'completed';

                // Simulate P&L based on outcome
                if (outcome === 'win') {
                    signal.pnl = (signal.target - signal.entry) * 100;
                } else {
                    signal.pnl = (signal.stop - signal.entry) * 100;
                }

                console.log(`Recording ${outcome} for ${signalId}`);

                updateMetrics();
                updateCharts();
                updateSignalsList();
                showRefreshIndicator();
            }
        }

        function refreshData() {
            loadData();
        }

        function showRefreshIndicator() {
            const indicator = document.getElementById('refreshIndicator');
            indicator.style.display = 'block';
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 2000);
        }
    </script>
</body>
</html>